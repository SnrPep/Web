<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Каталог машин</title>
</head>
<body>
    <h1>Каталог машин</h1>

    <form method="get">
        {{ filter.form.as_p }}
        <button type="submit">Фильтровать</button>
    </form>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const brandSelect = document.getElementById("id_brand");
        const modelSelect = document.getElementById("id_model");

        brandSelect.addEventListener("change", function () {
            const brandId = brandSelect.value;

            // Отправляем запрос на сервер, чтобы получить модели
            fetch(`/cars/get-models/?brand_id=${brandId}`)
                .then(response => response.json())
                .then(data => {
                    // Очищаем предыдущие опции модели
                    modelSelect.innerHTML = '<option value="">Модель авто</option>';

                    // Добавляем новые модели в выпадающий список
                    data.models.forEach(function (model) {
                        const option = document.createElement("option");
                        option.value = model;
                        option.textContent = model;
                        modelSelect.appendChild(option);
                    });
                })
                .catch(error => console.error("Ошибка при загрузке моделей:", error));
        });
    });
</script>

    <!-- Кнопки сортировки (ПОКА НЕ РАБОТАЮТ)-->
<div class="sort-buttons">
    <a href="?{% for key, value in request.GET.items %}{% if key != 'sort' %}{{ key }}={{ value }}&{% endif %}{% endfor %}sort=price">Сортировать по цене</a>
    <a href="?{% for key, value in request.GET.items %}{% if key != 'sort' %}{{ key }}={{ value }}&{% endif %}{% endfor %}sort=-price">Сортировать по цене (убыв.)</a>
    <a href="?{% for key, value in request.GET.items %}{% if key != 'sort' %}{{ key }}={{ value }}&{% endif %}{% endfor %}sort=year">Сортировать по году</a>
    <a href="?{% for key, value in request.GET.items %}{% if key != 'sort' %}{{ key }}={{ value }}&{% endif %}{% endfor %}sort=-year">Сортировать по году (убыв.)</a>
</div>
    <h2>Результаты</h2>
    <ul>
        {% for car in filter.qs %}
            <li>
                {{ car.brand_country.brand }} {{ car.make }} {{ car.model }} ({{ car.year }}) — {{ car.price }} ₽
                <br>Страна бренда: {{ car.brand_country.country }}
                <br>Пробег: {{ car.mileage }} км, Цвет: {{ car.color }}, КПП: {{ car.transmission }}
            </li>
        {% endfor %}
    </ul>
</body>
</html>


{#<form method="get">#}
{#    <div>#}
{#        {{ filter.form.brand.label_tag }}#}
{#        {{ filter.form.brand }}#}
{#    </div>#}
{#    <div>#}
{#        {{ filter.form.country.label_tag }}#}
{#        {{ filter.form.country }}#}
{#    </div>#}
{#    <div>#}
{#        {{ filter.form.model.label_tag }}#}
{#        {{ filter.form.model }}#}
{#    </div>#}
{#    <div>#}
{#        {{ filter.form.year_from.label_tag }}#}
{#        {{ filter.form.year_from }}#}
{#    </div>#}
{#    <div>#}
{#        {{ filter.form.year_to.label_tag }}#}
{#        {{ filter.form.year_to }}#}
{#    </div>#}
{#    <div>#}
{#        {{ filter.form.price_from.label_tag }}#}
{#        {{ filter.form.price_from }}#}
{#    </div>#}
{#    <div>#}
{#        {{ filter.form.price_to.label_tag }}#}
{#        {{ filter.form.price_to }}#}
{#    </div>#}
{#    <div>#}
{#        {{ filter.form.color.label_tag }}#}
{#        {{ filter.form.color }}#}
{#    </div>#}
{#    <div>#}
{#        {{ filter.form.transmission.label_tag }}#}
{#        {{ filter.form.transmission }}#}
{#    </div>#}
{#    <div>#}
{#        {{ filter.form.drive.label_tag }}#}
{#        {{ filter.form.drive }}#}
{#    </div>#}
{#    <div>#}
{#        {{ filter.form.engine_volume.label_tag }}#}
{#        {{ filter.form.engine_volume }}#}
{#    </div>#}
{#    <button type="submit">Применить фильтры</button>#}
{#</form>#}
